<!DOCTYPE html>
<head>
    <style>
        body {
            /*background-image: url("https://i.ytimg.com/vi/8myYyMg1fFE/maxresdefault.jpg");*/
            background-color: #cccccc;
            color: #ffffff;           
        }
    </style>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.5/angular.min.js"></script>
    <script src="https://www.w3schools.com/lib/w3data.js"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>
    
    <div w3-include-html="topnav.html"></div>
    <script>
        w3IncludeHTML();
    </script>
    <div ng-app="myApp" ng-controller="cntrl">
        <form>
            <h3>Owner Name: <input type="text" ng-model="name" name="ownername"
                ng-disabled="obj.idisable"></h3>
           <h3> Owner Type:</h3> <!--input type="text" ng-model="type" name="ownertype"-->
                <select ng-model="type">
                    <option value="person">Person</option>
                    <option value="company">Company</option>
                    <option value="government agency">Gov't Agency</option>
                </select>
             <input type="button" class="btn btn-primary"  value="{{btnName}}" ng-click="insertOwner()"> {{msg}}
            <input type="button" class="btn btn-info" value="Display All" ng-click="displayOwners()">
        </form>
        <table class="table">
            <thead>
                <tr>                   
                    <th class="text-muted"><h4>ID</h4></th>
                    <th class="text-muted"><h4>Name</h4></th>
                    <th class="text-muted"><h4>Type</h4></th>
                    </p>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="owner in data">
                    <td>{{owner.id}}</td>
                    <td>{{owner.name}}</td>
                    <td>{{owner.type}}
                        <td><button  class="btn btn-danger" ng-click="deleteOwner(owner.id);">Delete</button></td>
                        <td><button class="btn btn-primary" ng-click="editOwner(owner.id);">Edit</button></td>

                </tr>
            </tbody>
        </table>
    </div>
    <script>
        var app = angular.module('myApp', []);
        app.controller('cntrl', function ($scope, $http) {
            $scope.obj = { 'idisable': false };
            $scope.btnName = "Insert";

            $scope.insertOwner = function () {
                $http.post("/owners/add", { 'name': $scope.name, 'type': $scope.type })
                    .success(function (response) {
                        console.log(response);
                        $scope.msg = "Data Inserted";
                        $scope.displayOwners();
                    })
            }

            $scope.displayOwners = function () {
                $http.get("/owners/all")
                    .success(function (data) {
                        $scope.data = data
                        console.log('Got Owners');
                    })
            }

            $scope.deleteOwner = function (id) {
                var url = "/owners/delete/";
                $http.delete(url.concat(id))
                    .success(function () {
                        $scope.msg = "Data Deletion successful";
                        $scope.displayOwners();
                    })
            }

            $scope.editOwner = function (id) {
                var url = "/owners/edit/"
                $http.put(url.concat(id), { 'name': $scope.name, 'type': $scope.type })
                    .success(function () {
                        $scope.msg = "Data Edit successful";
                        $scope.displayOwners();
                    })
                /*$scope.id = id;
                $scope.name = name;
                $scope.type = type;
                $scope.btnName = "Update";
                $scope.obj.idisable = true;*/
                $scope.displayOwners();
            }
        });
    </script>
</body>

</html>